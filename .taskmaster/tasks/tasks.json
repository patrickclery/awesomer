{
  "master": {
    "tasks": [
      {
        "id": "1",
        "title": "Audit and Verify Existing CLI Commands",
        "description": "Run and document all existing `bin/awesomer` commands locally to verify current capabilities, identify dependencies, and confirm they work correctly before containerization.",
        "details": "## Implementation Steps\n\n### 1. Test Each CLI Command Locally\n```bash\n# Check worker commands\nbin/awesomer worker status    # Document current state\nbin/awesomer worker run-once  # Test single sync cycle\nbin/awesomer worker logs      # Review recent activity\n\n# Check sync commands\nbin/awesomer status           # Show AwesomeList records (expect 6 active)\nbin/awesomer sync             # Run complete sync sequence\nbin/awesomer update           # Update GitHub stats\nbin/awesomer publish          # Test publish (to awesomer-test first)\nbin/awesomer refresh          # Full refresh cycle\n```\n\n### 2. Document Environment Variables\nCreate inventory of required env vars:\n- `DATABASE_URL` - PostgreSQL connection string\n- `REDIS_URL` - Redis connection string\n- `GITHUB_API_KEY` - For GitHub API calls (star counts)\n- `GITHUB_ACCESS_TOKEN` - For git push operations\n- `RAILS_ENV` - production/development\n- `PUBLISH_REPO` - Target repo for publishing\n\n### 3. Verify Database State\n```bash\n# Check current database has expected data\nrails runner \"puts AwesomeList.active.count\"  # Should be 6\nrails runner \"puts AwesomeList.active.pluck(:name)\"\n```\n\n### 4. Test Publish to Test Repo\n```bash\n# Set PUBLISH_REPO=patrickclery/awesomer-test\nexport PUBLISH_REPO=patrickclery/awesomer-test\nbin/awesomer publish\n# Verify commit appears in awesomer-test repo\n```\n\n### 5. Document Findings\nCreate `docs/cli-audit.md` with:\n- Command descriptions and expected behavior\n- Required environment variables\n- Database/Redis connection requirements\n- Any issues or fixes needed",
        "testStrategy": "**Validation Approach:**\n1. Execute each `bin/awesomer` command and capture output\n2. Verify `worker run-once` completes without errors and updates star counts\n3. Confirm `status` shows 6 active lists with recent sync timestamps\n4. Test `publish` command commits to `awesomer-test` repo successfully\n5. Check GitHub API rate limit is respected during sync\n6. Verify Redis connection works for rate limiting\n7. Document any command failures or unexpected behavior for fixing before containerization",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-05T20:46:58.340Z"
      },
      {
        "id": "2",
        "title": "Create Dockerfile for Rails Application",
        "description": "Build a production-ready Dockerfile for the Awesomer Rails application that can run all `bin/awesomer` commands and includes necessary dependencies for GitHub operations.",
        "details": "## Implementation Steps\n\n### 1. Create Dockerfile\n```dockerfile\n# Dockerfile\nFROM ruby:3.3-slim\n\n# Install system dependencies\nRUN apt-get update -qq && apt-get install -y \\\n    build-essential \\\n    libpq-dev \\\n    git \\\n    curl \\\n    nodejs \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Set working directory\nWORKDIR /app\n\n# Install bundler\nRUN gem install bundler\n\n# Copy Gemfile first for layer caching\nCOPY Gemfile Gemfile.lock ./\nRUN bundle config set --local deployment 'true' && \\\n    bundle config set --local without 'development test' && \\\n    bundle install\n\n# Copy application code\nCOPY . .\n\n# Create output directory\nRUN mkdir -p /app/output\n\n# Configure git for commits (used by publish command)\nRUN git config --global user.email \"bot@awesomer.app\" && \\\n    git config --global user.name \"Awesomer Bot\"\n\n# Make bin scripts executable\nRUN chmod +x bin/*\n\n# Default command\nCMD [\"bin/awesomer\", \"status\"]\n```\n\n### 2. Create .dockerignore\n```\n# .dockerignore\n.git\nlog/*\ntmp/*\n.env*\ndata/\noutput/\nnode_modules/\n*.log\n.DS_Store\n```\n\n### 3. Build and Test Image\n```bash\n# Build the image\ndocker build -t awesomer-engine:latest .\n\n# Test basic command execution\ndocker run --rm awesomer-engine:latest bin/awesomer --help\n\n# Test with environment variables (won't connect but verifies startup)\ndocker run --rm \\\n  -e RAILS_ENV=production \\\n  awesomer-engine:latest \\\n  ruby -e \"puts 'Container starts correctly'\"\n```\n\n### 4. Optimize for Production\n- Use multi-stage build if needed to reduce image size\n- Ensure RAILS_ENV=production is respected\n- Precompile assets if any exist\n- Set appropriate file permissions",
        "testStrategy": "**Validation Approach:**\n1. Build Docker image successfully without errors\n2. Run `docker run --rm awesomer-engine bin/awesomer --help` to verify CLI is accessible\n3. Verify Ruby version matches project requirements (3.x)\n4. Check image size is reasonable (< 1GB)\n5. Confirm git is properly configured inside container\n6. Test that bundled gems are correctly installed\n7. Verify `/app/output` directory exists and is writable",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-05T21:13:53.822Z"
      },
      {
        "id": "3",
        "title": "Create Docker Compose Stack Configuration",
        "description": "Create docker-compose.yml with PostgreSQL, Redis, App, and Worker services configured with proper networking, volumes, environment variables, and health checks.",
        "details": "## Implementation Steps\n\n### 1. Create docker-compose.yml\n```yaml\n# docker-compose.yml\nversion: '3.8'\n\nservices:\n  db:\n    image: postgres:17\n    volumes:\n      - ./data/postgres:/var/lib/postgresql/data\n    environment:\n      POSTGRES_PASSWORD: postgres\n      POSTGRES_DB: awesomer\n      POSTGRES_USER: postgres\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U postgres\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    restart: unless-stopped\n\n  redis:\n    image: redis:7\n    volumes:\n      - ./data/redis:/data\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    restart: unless-stopped\n\n  app:\n    build: .\n    depends_on:\n      db:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n    environment:\n      DATABASE_URL: postgresql://postgres:postgres@db:5432/awesomer\n      REDIS_URL: redis://redis:6379/0\n      GITHUB_API_KEY: ${GITHUB_API_KEY}\n      GITHUB_ACCESS_TOKEN: ${GITHUB_ACCESS_TOKEN}\n      RAILS_ENV: production\n      PUBLISH_REPO: ${PUBLISH_REPO:-patrickclery/awesomer-test}\n    volumes:\n      - ./output:/app/output\n    stdin_open: true\n    tty: true\n\n  worker:\n    build: .\n    command: bin/awesomer worker start\n    depends_on:\n      db:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n    environment:\n      DATABASE_URL: postgresql://postgres:postgres@db:5432/awesomer\n      REDIS_URL: redis://redis:6379/0\n      GITHUB_API_KEY: ${GITHUB_API_KEY}\n      GITHUB_ACCESS_TOKEN: ${GITHUB_ACCESS_TOKEN}\n      RAILS_ENV: production\n      PUBLISH_REPO: ${PUBLISH_REPO:-patrickclery/awesomer-test}\n    volumes:\n      - ./output:/app/output\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"bin/awesomer\", \"worker\", \"status\"]\n      interval: 60s\n      timeout: 30s\n      retries: 3\n      start_period: 30s\n\nvolumes:\n  postgres_data:\n  redis_data:\n```\n\n### 2. Create .env.example\n```bash\n# .env.example\nGITHUB_API_KEY=ghp_your_github_api_token\nGITHUB_ACCESS_TOKEN=ghp_your_github_access_token\nPUBLISH_REPO=patrickclery/awesomer-test\n```\n\n### 3. Create Helper Scripts\n```bash\n# scripts/docker-setup.sh\n#!/bin/bash\nset -e\n\necho \"Creating data directories...\"\nmkdir -p data/postgres data/redis output\n\necho \"Building containers...\"\ndocker compose build\n\necho \"Starting database and redis...\"\ndocker compose up -d db redis\n\necho \"Waiting for services to be healthy...\"\nsleep 10\n\necho \"Running database migrations...\"\ndocker compose run --rm app bin/rails db:migrate\n\necho \"Setup complete! Run 'docker compose up -d' to start all services.\"\n```\n\n```bash\n# scripts/docker-run.sh\n#!/bin/bash\n# Helper to run awesomer commands in container\ndocker compose run --rm app bin/awesomer \"$@\"\n```\n\n### 4. Create docker-compose.override.yml for Development\n```yaml\n# docker-compose.override.yml (optional, for local dev)\nversion: '3.8'\nservices:\n  app:\n    volumes:\n      - .:/app\n      - bundle_cache:/usr/local/bundle\n\nvolumes:\n  bundle_cache:\n```",
        "testStrategy": "**Validation Approach:**\n1. Run `docker compose config` to validate YAML syntax\n2. Execute `docker compose up -d db redis` and verify services start\n3. Check health checks pass: `docker compose ps` shows healthy status\n4. Run `docker compose run --rm app bin/awesomer status` to verify app connects to services\n5. Verify volumes are created and persist data after restart\n6. Test environment variable substitution from .env file\n7. Confirm worker service starts and stays running with `docker compose up -d worker`\n8. Check logs with `docker compose logs worker` for any errors",
        "priority": "high",
        "dependencies": [
          "2"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-05T21:17:11.016Z"
      },
      {
        "id": "4",
        "title": "Test Complete Sync and Publish Workflow in Containers",
        "description": "Validate the full automation cycle (sync → process → publish) works correctly in Docker containers, targeting the awesomer-test repository first before production.",
        "details": "## Implementation Steps\n\n### 1. Initialize Database in Container\n```bash\n# Start services\ndocker compose up -d db redis\n\n# Wait for healthy status\ndocker compose ps\n\n# Run migrations\ndocker compose run --rm app bin/rails db:migrate\n\n# Verify database state (should have 6 active lists)\ndocker compose run --rm app bin/awesomer status\n```\n\n### 2. Test Individual Commands\n```bash\n# Test sync command\ndocker compose run --rm app bin/awesomer sync\n\n# Test update command\ndocker compose run --rm app bin/awesomer update\n\n# Check status after sync\ndocker compose run --rm app bin/awesomer status\n```\n\n### 3. Test Publish to Test Repository\n```bash\n# Ensure PUBLISH_REPO is set to test repo in .env\n# PUBLISH_REPO=patrickclery/awesomer-test\n\n# Run publish command\ndocker compose run --rm app bin/awesomer publish\n\n# Verify in GitHub:\n# - Check awesomer-test repo for new commit\n# - Verify markdown files are correctly formatted\n# - Check star counts are present in files\n```\n\n### 4. Test Worker Daemon\n```bash\n# Start worker service\ndocker compose up -d worker\n\n# Check worker status\ndocker compose exec worker bin/awesomer worker status\n\n# Monitor logs\ndocker compose logs -f worker\n\n# Verify scheduled sync runs (check logs for 2:00 AM UTC trigger or manual test)\n```\n\n### 5. Test Full Refresh Cycle\n```bash\n# Run complete refresh\ndocker compose run --rm app bin/awesomer refresh\n\n# Verify output files generated\nls -la output/\n\n# Check file contents\ncat output/*.md | head -50\n```\n\n### 6. Test Multiple Sync Cycles\n```bash\n# Run sync multiple times to ensure incremental updates work\nfor i in 1 2 3; do\n  echo \"Sync cycle $i\"\n  docker compose run --rm app bin/awesomer worker run-once\n  sleep 5\ndone\n\n# Verify no duplicate commits or errors\n```\n\n### 7. Validate Rate Limiting\n```bash\n# Check Redis is being used for rate limiting\ndocker compose exec redis redis-cli KEYS '*'\n\n# Monitor API calls during sync\ndocker compose logs app | grep -i \"rate\\|api\"\n```",
        "testStrategy": "**Validation Approach:**\n1. Verify `bin/awesomer status` shows 6 active lists with updated sync timestamps\n2. Confirm `bin/awesomer sync` completes without GitHub API rate limit errors\n3. Check `awesomer-test` repository receives commits with correct markdown content\n4. Validate star counts in generated markdown files match GitHub data\n5. Verify worker daemon stays running and auto-restarts on failure\n6. Test `worker run-once` completes a full cycle successfully\n7. Confirm multiple sync cycles don't create duplicate data or commits\n8. Check Redis rate limiting keys are created during sync\n9. Verify output directory contains expected markdown files",
        "priority": "high",
        "dependencies": [
          "3"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "5",
        "title": "Production Deployment and Documentation",
        "description": "Switch publish target to production awesomer repository, create deployment documentation, startup/shutdown scripts, and prepare for Synology deployment.",
        "details": "## Implementation Steps\n\n### 1. Switch to Production Repository\n```bash\n# Update .env file\nPUBLISH_REPO=patrickclery/awesomer\n\n# Or use environment variable override\nexport PUBLISH_REPO=patrickclery/awesomer\n\n# Test publish to production\ndocker compose run --rm app bin/awesomer publish\n```\n\n### 2. Create Startup/Shutdown Scripts\n```bash\n# scripts/start.sh\n#!/bin/bash\nset -e\necho \"Starting Awesomer stack...\"\ndocker compose up -d\necho \"Waiting for services...\"\nsleep 10\ndocker compose ps\necho \"Stack started successfully!\"\n```\n\n```bash\n# scripts/stop.sh\n#!/bin/bash\necho \"Stopping Awesomer stack...\"\ndocker compose down\necho \"Stack stopped.\"\n```\n\n```bash\n# scripts/logs.sh\n#!/bin/bash\ndocker compose logs -f \"${1:-worker}\"\n```\n\n```bash\n# scripts/sync-now.sh\n#!/bin/bash\necho \"Running manual sync...\"\ndocker compose run --rm app bin/awesomer sync\necho \"Sync complete!\"\n```\n\n### 3. Create README Documentation\n```markdown\n# Awesomer Docker Deployment\n\n## Quick Start\n\n1. Copy environment file:\n   ```bash\n   cp .env.example .env\n   # Edit .env with your GitHub tokens\n   ```\n\n2. Run setup:\n   ```bash\n   ./scripts/docker-setup.sh\n   ```\n\n3. Start the stack:\n   ```bash\n   ./scripts/start.sh\n   ```\n\n## Environment Variables\n\n| Variable | Description | Required |\n|----------|-------------|----------|\n| GITHUB_API_KEY | GitHub API token for fetching star counts | Yes |\n| GITHUB_ACCESS_TOKEN | GitHub token for pushing to repos | Yes |\n| PUBLISH_REPO | Target repo for publishing | Yes |\n| RAILS_ENV | Rails environment (production) | Yes |\n\n## Commands\n\n- `./scripts/start.sh` - Start all services\n- `./scripts/stop.sh` - Stop all services\n- `./scripts/logs.sh` - View worker logs\n- `./scripts/sync-now.sh` - Run manual sync\n- `docker compose run --rm app bin/awesomer status` - Check status\n\n## Monitoring\n\nThe worker runs daily sync at 2:00 AM UTC. Check status:\n```bash\ndocker compose exec worker bin/awesomer worker status\n```\n\n## Troubleshooting\n\n### Worker not syncing\n```bash\ndocker compose restart worker\ndocker compose logs worker\n```\n\n### Database issues\n```bash\ndocker compose run --rm app bin/rails db:migrate\n```\n```\n\n### 4. Create Health Check Endpoint (Optional Enhancement)\n```ruby\n# If needed, add to Rails app:\n# config/routes.rb\nget '/health', to: proc { [200, {}, ['OK']] }\n```\n\n### 5. Prepare Synology Deployment Notes\n```markdown\n# Synology Deployment (Future)\n\n## Prerequisites\n- Docker package installed on Synology\n- SSH access enabled\n- Sufficient storage for PostgreSQL data\n\n## Steps\n1. Copy project to Synology shared folder\n2. SSH into Synology\n3. Navigate to project directory\n4. Run `docker compose up -d`\n\n## Notes\n- Use Synology Task Scheduler as backup for cron\n- Consider Container Manager UI for monitoring\n- Ensure volume paths are correct for Synology filesystem\n```\n\n### 6. Final Production Verification\n```bash\n# Full production test\n./scripts/start.sh\n\n# Verify all services healthy\ndocker compose ps\n\n# Check worker is running\ndocker compose exec worker bin/awesomer worker status\n\n# Run a sync cycle\n./scripts/sync-now.sh\n\n# Verify publish to production repo\n# Check https://github.com/patrickclery/awesomer for new commit\n```",
        "testStrategy": "**Validation Approach:**\n1. Verify production publish commits appear in `patrickclery/awesomer` repository\n2. Test all helper scripts execute without errors\n3. Confirm stack starts cleanly on fresh machine with only Docker installed\n4. Validate documentation is complete and accurate by following it on clean setup\n5. Check worker auto-restarts after simulated failure (`docker compose kill worker`)\n6. Verify 24-hour sync cycle completes successfully (or test with shortened interval)\n7. Confirm no manual intervention needed for 48+ hours of operation\n8. Test deployment steps work on target Synology NAS (when ready)\n9. Verify success metrics: 95%+ repos synced, zero rate limit errors, daily updates",
        "priority": "medium",
        "dependencies": [
          "4"
        ],
        "status": "pending",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2026-01-05T21:17:11.016Z",
      "taskCount": 5,
      "completedCount": 3,
      "tags": [
        "master"
      ]
    }
  }
}